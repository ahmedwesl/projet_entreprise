/**
 * Created by jean.rennes on 21/10/2015.
 */

namespace AFC.Controls {
    export class Autocomplete {
        private _container: JQuery;
        private _autocomplete: JQuery;

        constructor(element:any) {
            this._container = jQuery(typeof element === 'string' ? document.getElementById(element) : element);
        }

        private static _createSource(provider: (value: string, callback: (data?: any[])=>void)=>void):(request: any, response: (data?: any[])=>void)=>void {
            return function(request: any, response: (data?: any[])=>void):void {
                provider(request.term, response);
            };
        }

        public setProvider(provider: (value: string, callback: (data?: any[])=>void)=>void):void {
            this._autocomplete = this._container.autocomplete({minLength: 1,source: Autocomplete._createSource(provider)});
        }

        public refresh():void {
            if (this._autocomplete) this._container.autocomplete("search", "");
        }

        public on(str: string, callback: JQueryUI.AutocompleteEvent):void {
            if (this._autocomplete) this._autocomplete.on(`autocomplete${str}`, <any>callback);
        }

        public destroy():void {
            if (this._autocomplete) this._autocomplete.autocomplete("destroy");
            delete this._container;
            delete this._autocomplete;
        }
    }
}