/**
 * Created by jean.rennes on 19/09/2017.
 */
///<reference path="../Globals.ts" />
///<reference path="../../models/data/Data.ts" />

namespace AFC.gui {
    export class AfcGuiComboBox extends AfcBindableElement<AFC.Data.IDataSource & Tools.IObservable, Data.ComboBoxAdapter> {
        protected _control: Controls.ComboBox;
        public static observedAttributes = AfcBindableElement.observedAttributes.concat(['value', 'disabled']);
        
        constructor() {
            super();
            this._adapter                  = new Data.ComboBoxAdapter(this._control = new Controls.ComboBox(this));
            this._adapter.onControlChange  = this.onchange;
        }
        
        protected _onGenerate(): void {
            this._control.loadingEnd();
            _dispatchEvent(this, 'dataChange');
        }

        public connectedCallback(): void {
            $(this).empty();
            this._control.loadingStart();
            this._adapter.onGenerate = this._onGenerate.bind(this);
            super.connectedCallback();
        }
        
        public disconnectedCallback(): void {
            delete this._adapter.onGenerate;
            super.disconnectedCallback();
        }
        
        public attributeChangedCallback(attrName: string, oldVal: string, newVal: string): void {
            switch (attrName) {
                case 'value':
                    this.value = newVal;
                    break;
                case 'disabled':
                    this._control.disabled = (newVal != "" ? true : false);
                    break;
                default:
                    super.attributeChangedCallback(attrName, oldVal, newVal);
                    break;
            }
        }
        
        public set disabled(newVal: boolean) {
            if (newVal)
                this.setAttribute("disabled", "");
            else
                this.removeAttribute("disabled");
            this._control.disabled = newVal;
        }
        public get disabled() {
            return this._control.disabled;
        }
                    
        public set value(newVal: string) {
            this._adapter.value = newVal;
        }
            
        public get value(): string {
            return this._adapter.value;
        }
        
        public refresh(): void {
            this._adapter.refresh();
        }
    }
    registerElement("afc-gui-combobox", AfcGuiComboBox);
}